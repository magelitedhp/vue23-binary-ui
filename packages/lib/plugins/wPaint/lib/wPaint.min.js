/*! wPaint - v2.5.0 - 2014-03-01 */ !(function (a) {
  'use strict'
  window.CanvasRenderingContext2D && (CanvasRenderingContext2D.prototype.ellipse = function (a, b, c, d) {
    if (!(a && b && c && d)) return !0
    var e = 0.5522848,
      f = c / 2 * e,
      g = d / 2 * e,
      h = a + c,
      i = b + d,
      j = a + c / 2,
      k = b + d / 2
    this.beginPath(), this.moveTo(a, k), this.bezierCurveTo(a, k - g, j - f, b, j, b), this.bezierCurveTo(j + f, b, h, k - g, h, k), this.bezierCurveTo(h, k + g, j + f, i, j, i), this.bezierCurveTo(j - f, i, a, k + g, a, k), this.closePath()
  })

  function b (b, c) { this.$el = a(b), this.options = c, this.init = !1, this.menus = { primary: null, active: null, all: {} }, this.previousMode = null, this.width = this.$el.width(), this.height = this.$el.height(), this.ctxBgResize = !1, this.ctxResize = !1, this.generate(), this._init() }

  function c (a, b, c) { this.wPaint = a, this.options = c, this.name = b, this.type = a.menus.primary ? 'secondary' : 'primary', this.docked = !0, this.dockOffset = { left: 0, top: 0 }, this.generate() } b.prototype = {
    generate: function () {
      function b (b) {
        var c = b ? b.capitalize() : '',
          d = 'canvas' + c,
          e = 'ctx' + c
        return f[d] = document.createElement('canvas'), f[e] = f[d].getContext('2d'), f['$' + d] = a(f[d]), f['$' + d].attr('class', 'wPaint-canvas' + (b ? '-' + b : '')).attr('width', f.width + 'px').attr('height', f.height + 'px').css({ position: 'absolute', left: 0, top: 0 }), f.$el.append(f['$' + d]), f['$' + d]
      }

      function c (a) { a.preventDefault(), a.stopPropagation(), f.draw = !0, a.canvasEvent = 'down', f._closeSelectBoxes(), f._callShapeFunc.apply(f, [a]) }

      function d (a) { f.draw && (a.canvasEvent = 'move', f._callShapeFunc.apply(f, [a])) }

      function e (a) { f.draw && (f.draw = !1, a.canvasEvent = 'up', f._callShapeFunc.apply(f, [a])) }
      if (this.init) return this
      var f = this
      b('bg'), b('').on('mousedown', c).bindMobileEvents(), b('temp').hide(), a(document).on('mousemove', d).on('mousedown', a.proxy(this._closeSelectBoxes, this)).on('mouseup', e), this.setTheme(this.options.theme)
    },
    _init: function () {
      var a = null,
        b = null
      this.init = !0
      for (a in this.options) b = 'set' + a.capitalize(), this[b] && this[b](this.options[a])
      this._fixMenus(), this.menus.primary._getIcon(this.options.mode).trigger('click')
    },
    resize: function () {
      var a = this.getBg(),
        b = this.getImage()
      this.width = this.$el.width(), this.height = this.$el.height(), this.canvasBg.width = this.width, this.canvasBg.height = this.height, this.canvas.width = this.width, this.canvas.height = this.height, this.ctxBgResize === !1 && (this.ctxBgResize = !0, this.setBg(a, !0)), this.ctxResize === !1 && (this.ctxResize = !0, this.setImage(b, '', !0, !0))
    },
    setTheme: function (a) { var b, c; for (a = a.split(' '), this.$el.attr('class', (this.$el.attr('class') || '').replace(/wPaint-theme-.+\s|wPaint-theme-.+$/, '')), b = 0, c = a.length; c > b; b++) this.$el.addClass('wPaint-theme-' + a[b]) },
    setMode: function (a) { this.setCursor(a), this.previousMode = this.options.mode, this.options.mode = a },
    setImage: function (b, c, d, e) {
      function f () {
        var a = 1,
          b = 0,
          f = 0,
          j = 0,
          k = 0,
          l = h.width,
          m = h.height
        d || ((h.width > g.width || h.height > g.height || g.options.imageStretch) && (b = g.width / h.width, f = g.height / h.height, a = f > b ? b : f, l = h.width * a, m = h.height * a), j = (g.width - l) / 2, k = (g.height - m) / 2), i.clearRect(0, 0, g.width, g.height), i.drawImage(h, j, k, l, m), g[c + 'Resize'] = !1, e || g._addUndo()
      }
      if (!b) return !0
      var g = this,
        h = null,
        i = ''
      c = 'ctx' + (c || '').capitalize(), i = this[c], window.rgbHex(b) ? (i.clearRect(0, 0, this.width, this.height), i.fillStyle = b, i.rect(0, 0, this.width, this.height), i.fill()) : (h = new Image(), h.src = b.toString(), a(h).load(f))
    },
    setBg: function (a, b) { return a ? void this.setImage(a, 'bg', b, !0) : !0 },
    setCursor: function (b) { b = a.fn.wPaint.cursors[b] || a.fn.wPaint.cursors['default'], this.$el.css('cursor', 'url("' + this.options.path + b.path + '") ' + b.left + ' ' + b.top + ', default') },
    setMenuOrientation: function (b) { a.each(this.menus.all, function (a, c) { c.options.aligment = b, c.setAlignment(b) }) },
    getImage: function (b) {
      var c = document.createElement('canvas'),
        d = c.getContext('2d')
      return b = b === !1 ? !1 : !0, a(c).css({ display: 'none', position: 'absolute', left: 0, top: 0 }).attr('width', this.width).attr('height', this.height), b && d.drawImage(this.canvasBg, 0, 0), d.drawImage(this.canvas, 0, 0), c.toDataURL()
    },
    getBg: function () { return this.canvasBg.toDataURL() },
    _displayStatus: function (b) {
      var c = this
      this.$status || (this.$status = a('<div class="wPaint-status"></div>'), this.$el.append(this.$status)), this.$status.html(b), clearTimeout(this.displayStatusTimer), this.$status.fadeIn(500, function () { c.displayStatusTimer = setTimeout(function () { c.$status.fadeOut(500) }, 1500) })
    },
    _showModal: function (a) {
      function b () { d.remove(), e.remove(), c._createModal(a) }
      var c = this,
        d = this.$el.children('.wPaint-modal-bg'),
        e = this.$el.children('.wPaint-modal')
      d.length ? e.fadeOut(500, b) : this._createModal(a)
    },
    _createModal: function (b) {
      function c () { f.fadeOut(500, d) }

      function d () { e.remove(), f.remove() } b = a('<div class="wPaint-modal-content"></div>').append(b.children())
      var e = a('<div class="wPaint-modal-bg"></div>'),
        f = a('<div class="wPaint-modal"></div>'),
        g = a('<div class="wPaint-modal-holder"></div>'),
        h = a('<div class="wPaint-modal-close">X</div>')
      h.on('click', c), f.append(g.append(b)).append(h), this.$el.append(e).append(f), f.css({ left: this.$el.outerWidth() / 2 - f.outerWidth(!0) / 2, top: this.$el.outerHeight() / 2 - f.outerHeight(!0) / 2 }), f.fadeIn(500)
    },
    _createMenu: function (a, b) { return b = b || {}, b.alignment = this.options.menuOrientation, b.handle = this.options.menuHandle, new c(this, a, b) },
    _fixMenus: function () {
      function b (b, d) {
        var e = a(d),
          f = e.clone()
        f.appendTo(c.$el), f.outerHeight() === f.get(0).scrollHeight && e.css({ overflowY: 'auto' }), f.remove()
      }
      var c = this,
        d = null
      for (var e in this.menus.all) d = c.menus.all[e].$menu.find('.wPaint-menu-select-holder'), d.length && d.children().each(b)
    },
    _closeSelectBoxes: function (a) { var b, c; for (b in this.menus.all) c = this.menus.all[b].$menuHolder.children('.wPaint-menu-icon-select'), a && (c = c.not('.wPaint-menu-icon-name-' + a.name)), c.children('.wPaint-menu-select-holder').hide() },
    _callShapeFunc: function (a) {
      var b = this.$canvas.offset(),
        c = a.canvasEvent.capitalize(),
        d = '_draw' + this.options.mode.capitalize() + c
      a.pageX = Math.floor(a.pageX - b.left), a.pageY = Math.floor(a.pageY - b.top), this[d] && this[d].apply(this, [a]), this.options['draw' + c] && this.options['_draw' + c].apply(this, [a]), c === 'Down' && this.options.onShapeDown ? this.options.onShapeDown.apply(this, [a]) : c === 'Move' && this.options.onShapeMove ? this.options.onShapeMove.apply(this, [a]) : c === 'Up' && this.options.onShapeUp && this.options.onShapeUp.apply(this, [a])
    },
    _stopPropagation: function (a) { a.stopPropagation() },
    _drawShapeDown: function (a) { this.$canvasTemp.css({ left: a.PageX, top: a.PageY }).attr('width', 0).attr('height', 0).show(), this.canvasTempLeftOriginal = a.pageX, this.canvasTempTopOriginal = a.pageY },
    _drawShapeMove: function (b, c) {
      var d = this.canvasTempLeftOriginal,
        e = this.canvasTempTopOriginal
      c = c || 2, b.left = b.pageX < d ? b.pageX : d, b.top = b.pageY < e ? b.pageY : e, b.width = Math.abs(b.pageX - d)
      if (b.left < 0) { b.left = 0, b.width = d } else { b.width = (b.left + b.width) < $(this.canvas).width() ? b.width : ($(this.canvas).width() - b.left) } b.height = Math.abs(b.pageY - e)
      if (b.top < 0) { b.top = 0, b.height = e } else { b.height = (b.top + b.height) < $(this.canvas).height() ? b.height : ($(this.canvas).height() - b.top) } b.x = this.options.lineWidth / 2 * c, b.y = this.options.lineWidth / 2 * c, b.w = b.width - this.options.lineWidth * c, b.h = b.height - this.options.lineWidth * c, a(this.canvasTemp).css({ left: b.left, top: b.top }).attr('width', b.width).attr('height', b.height), this.canvasTempLeftNew = b.left, this.canvasTempTopNew = b.top, c = c || 2, this.ctxTemp.fillStyle = this.options.fillStyle, this.ctxTemp.strokeStyle = this.options.strokeStyle, this.ctxTemp.lineWidth = this.options.lineWidth * c
    },
    _drawShapeUp: function () { this.ctx.drawImage(this.canvasTemp, this.canvasTempLeftNew, this.canvasTempTopNew), this.$canvasTemp.hide() },
    _drawDropperDown: function (a) {
      var b = { x: a.pageX, y: a.pageY },
        c = this._getPixel(this.ctx, b),
        d = null
      d = 'rgba(' + [c.r, c.g, c.b, c.a].join(',') + ')', this.options[this.dropper] = d, this.menus.active._getIcon(this.dropper).wColorPicker('color', d)
    },
    _drawDropperUp: function () { this.setMode(this.previousMode) },
    _getPixel: function (a, b) {
      var c = a.getImageData(0, 0, this.width, this.height),
        d = c.data,
        e = 4 * (b.y * c.width + b.x)
      return { r: d[e], g: d[e + 1], b: d[e + 2], a: d[e + 3] }
    }
  }, c.prototype = {
    generate: function () { this.$menu = a('<div class="wPaint-menu"></div>'), this.$menuHolder = a('<div class="wPaint-menu-holder wPaint-menu-name-' + this.name + '"></div>'), this.options.handle ? this.$menuHandle = this._createHandle() : this.$menu.addClass('wPaint-menu-nohandle'), this.type === 'primary' ? (this.wPaint.menus.primary = this, this.setOffsetLeft(this.options.offsetLeft), this.setOffsetTop(this.options.offsetTop)) : this.type === 'secondary' && this.$menu.hide(), this.$menu.append(this.$menuHolder.append(this.$menuHandle)), this.reset(), this.wPaint.$el.parent().next().append(this.$menu), this.setAlignment(this.options.alignment) },
    reset: function () {
      function b (a) { d._appendItem(a) }
      var c, d = this,
        e = a.fn.wPaint.menus[this.name]
      for (c in e.items) this.$menuHolder.children('.wPaint-menu-icon-name-' + c).length || (e.items[c].name = c, e.items[c].img = e.items[c].img || (d.wPaint.options.path + e.img), b(e.items[c]))
    },
    _appendItem: function (a) {
      var b = this['_createIcon' + a.icon.capitalize()](a)
      a.after ? this.$menuHolder.children('.wPaint-menu-icon-name-' + a.after).after(b) : this.$menuHolder.append(b)
    },
    setOffsetLeft: function (a) { this.$menu.css({ left: a }) },
    setOffsetTop: function (a) { this.$menu.css({ top: a }) },
    setAlignment: function (a) {
      var b = this.$menu.css('left')
      this.$menu.attr('class', this.$menu.attr('class').replace(/wPaint-menu-alignment-.+\s|wPaint-menu-alignment-.+$/, '')), this.$menu.addClass('wPaint-menu-alignment-' + a), this.$menu.width('auto').css('left', -1e4), this.$menu.width(this.$menu.width()).css('left', b), this.type === 'secondary' && (this.options.alignment === 'horizontal' ? this.dockOffset.top = this.wPaint.menus.primary.$menu.outerHeight(!0) : this.dockOffset.left = this.wPaint.menus.primary.$menu.outerWidth(!0))
    },
    _createHandle: function () {
      function b () { e.docked = !1, e._setDrag() }

      function c () {
        a.each(e.$menu.data('ui-draggable').snapElements, function (a, b) {
          var c = e.$menu.offset(),
            d = e.wPaint.menus.primary.$menu.offset()
          e.dockOffset.left = c.left - d.left, e.dockOffset.top = c.top - d.top, e.docked = b.snapping
        }), e._setDrag()
      }

      function d () { e._setIndex() }
      var e = this,
        f = a('<div class="wPaint-menu-handle"></div>')
      return this.$menu.draggable({ handle: f }), this.type === 'secondary' && (this.$menu.draggable('option', 'snap', this.wPaint.menus.primary.$menu), this.$menu.draggable('option', 'start', b), this.$menu.draggable('option', 'stop', c), this.$menu.draggable('option', 'drag', d)), f.bindMobileEvents(), f
    },
    _createIconBase: function (b) {
      function c (b) {
        var c = a(b.currentTarget)
        c.siblings('.hover').removeClass('hover'), c.hasClass('disabled') || c.addClass('hover')
      }

      function d (b) { a(b.currentTarget).removeClass('hover') }

      function e () { f.wPaint.menus.active = f }
      var f = this,
        g = a('<div class="wPaint-menu-icon wPaint-menu-icon-name-' + b.name + '"></div>'),
        h = a('<div class="wPaint-menu-icon-img"></div>'),
        i = h.realWidth(null, null, this.wPaint.$el)
      return g.attr('title', b.title).on('mousedown', a.proxy(this.wPaint._closeSelectBoxes, this.wPaint, b)).on('mouseenter', c).on('mouseleave', d).on('click', e), a.isNumeric(b.index) && h.css({ backgroundImage: 'url(' + b.img + ')', backgroundPosition: -i * b.index + 'px 0px' }), g.append(h)
    },
    _createIconGroup: function (b) {
      function c () { h.children('.wPaint-menu-select-holder').is(':visible') || b.callback.apply(f.wPaint, []) }

      function d () { h.addClass('active').siblings('.active').removeClass('active') }

      function e () { h.attr('title', b.title).off('click.setIcon').on('click.setIcon', c), h.children('.wPaint-menu-icon-img').css(g), b.callback.apply(f.wPaint, []) }
      var f = this,
        g = { backgroundImage: 'url(' + b.img + ')' },
        h = this.$menuHolder.children('.wPaint-menu-icon-group-' + b.group),
        i = h.length,
        j = null,
        k = null,
        l = null,
        m = 0
      return i || (h = this._createIconBase(b).addClass('wPaint-menu-icon-group wPaint-menu-icon-group-' + b.group).on('click.setIcon', c).on('mousedown', a.proxy(this._iconClick, this))), m = h.children('.wPaint-menu-icon-img').realWidth(null, null, this.wPaint.$el), g.backgroundPosition = -m * b.index + 'px center', j = h.children('.wPaint-menu-select-holder'), j.length || (j = this._createSelectBox(h), j.children().on('click', d)), l = a('<div class="wPaint-menu-icon-select-img"></div>').attr('title', b.title).css(g), k = this._createSelectOption(j, l).addClass('wPaint-menu-icon-name-' + b.name).on('click', e), b.after && j.children('.wPaint-menu-select').children('.wPaint-menu-icon-name-' + b.after).after(k), i ? void 0 : h
    },
    _createIconGeneric: function (a) { return this._createIconActivate(a) },
    _createIconActivate: function (a) {
      function b (b) { a.icon !== 'generic' && c._iconClick(b), a.callback.apply(c.wPaint, [b]) }
      if (a.group) return this._createIconGroup(a)
      var c = this,
        d = this._createIconBase(a)
      return d.on('click', b), d
    },
    _isIconDisabled: function (a) { return this.$menuHolder.children('.wPaint-menu-icon-name-' + a).hasClass('disabled') },
    _setIconDisabled: function (a, b) {
      var c = this.$menuHolder.children('.wPaint-menu-icon-name-' + a)
      b ? c.addClass('disabled').removeClass('hover') : c.removeClass('disabled')
    },
    _getIcon: function (a) { return this.$menuHolder.children('.wPaint-menu-icon-name-' + a) },
    _iconClick: function (b) {
      var c = a(b.currentTarget),
        d = this.wPaint.menus.all
      for (var e in d) d[e] && d[e].type === 'secondary' && d[e].$menu.hide()
      c.siblings('.active').removeClass('active'), c.hasClass('disabled') || c.addClass('active')
    },
    _createIconToggle: function (a) {
      function b () { d.toggleClass('active'), a.callback.apply(c.wPaint, [d.hasClass('active')]) }
      var c = this,
        d = this._createIconBase(a)
      return d.on('click', b), d
    },
    _createIconSelect: function (b) {
      function c (c) { h.children('.wPaint-menu-icon-img').html(a(c.currentTarget).html()), b.callback.apply(g.wPaint, [a(c.currentTarget).html()]) }
      var d, e, f, g = this,
        h = this._createIconBase(b),
        i = this._createSelectBox(h)
      for (d = 0, e = b.range.length; e > d; d++) f = this._createSelectOption(i, b.range[d]), f.on('click', c), b.useRange && f.css(b.name, b.range[d])
      return h
    },
    _createSelectBox: function (b) {
      function c (a) { a.stopPropagation(), g.hide() }

      function d () { i = setTimeout(function () { g.toggle() }, 200) }

      function e () { clearTimeout(i) }

      function f () { g.toggle() }
      var g = a('<div class="wPaint-menu-select-holder"></div>'),
        h = a('<div class="wPaint-menu-select"></div>'),
        i = null
      return g.on('mousedown mouseup', this.wPaint._stopPropagation).on('click', c).hide(), g.css(this.options.alignment === 'horizontal' ? { left: 0, top: b.children('.wPaint-menu-icon-img').realHeight('outer', !0, this.wPaint.$el) } : { left: b.children('.wPaint-menu-icon-img').realWidth('outer', !0, this.wPaint.$el), top: 0 }), b.addClass('wPaint-menu-icon-select').append('<div class="wPaint-menu-icon-group-arrow"></div>').append(g.append(h)), b.hasClass('wPaint-menu-icon-group') ? b.on('mousedown', d).on('mouseup', e) : b.on('click', f), g
    },
    _createSelectOption: function (b, c) {
      var d = b.children('.wPaint-menu-select'),
        e = a('<div class="wPaint-menu-select-option"></div>').append(c)
      return d.children().length || e.addClass('first'), d.append(e), e
    },
    _setSelectValue: function (a, b) { this._getIcon(a).children('.wPaint-menu-icon-img').html(b) },
    _createIconColorPicker: function (a) {
      function b () { e.wPaint.options.mode === 'dropper' && e.wPaint.setMode(e.wPaint.previousMode) }

      function c (b) { a.callback.apply(e.wPaint, [b]) }

      function d () { f.trigger('click'), e.wPaint.dropper = a.name, e.wPaint.setMode('dropper') }
      var e = this,
        f = this._createIconBase(a)
      return f.on('click', b).addClass('wPaint-menu-colorpicker').wColorPicker({ mode: 'click', generateButton: !1, dropperButton: !0, onSelect: c, onDropper: d }), f
    },
    _setColorPickerValue: function (a, b) { this._getIcon(a).children('.wPaint-menu-icon-img').css('backgroundColor', b) },
    _createIconMenu: function (a) {
      function b () {
        c.wPaint.setCursor(a.name)
        var b = c.wPaint.menus.all[a.name]
        b.$menu.toggle(), c.handle ? b._setDrag() : b._setPosition()
      }
      var c = this,
        d = this._createIconActivate(a)
      return d.on('click', b), d
    },
    _setDrag: function () {
      var b = this.$menu,
        c = null,
        d = null
      b.is(':visible') && (this.docked && (c = d = a.proxy(this._setPosition, this), this._setPosition()), this.wPaint.menus.primary.$menu.draggable('option', 'drag', c), this.wPaint.menus.primary.$menu.draggable('option', 'stop', d))
    },
    _setPosition: function () {
      var a = this.wPaint.menus.primary.$menu.position()
      this.$menu.css({ left: a.left + this.dockOffset.left, top: a.top + this.dockOffset.top })
    },
    _setIndex: function () {
      var a = this.wPaint.menus.primary.$menu.offset(),
        b = this.$menu.offset()
      b.top < a.top || b.left < a.left ? this.$menu.addClass('wPaint-menu-behind') : this.$menu.removeClass('wPaint-menu-behind')
    }
  }, a.support.canvas = document.createElement('canvas').getContext, a.fn.wPaint = function (c, d) {
    function e () { return a.support.canvas ? a.proxy(f, this)() : (a(this).html('Browser does not support HTML5 canvas, please upgrade to a more modern browser.'), !1) }

    function f () { var d = a.data(this, 'wPaint'); return d || (d = new b(this, a.extend(!0, {}, c)), a.data(this, 'wPaint', d)), d }

    function g () {
      var b = a.data(this, 'wPaint')
      b && (b[c] ? b[c].apply(b, [d]) : void 0 !== d ? (b[i] && b[i].apply(b, [d]), b.options[c] && (b.options[c] = d)) : h.push(b[i] ? b[i].apply(b, [d]) : b.options[c] ? b.options[c] : void 0))
    }
    if (typeof c === 'string') {
      var h = [],
        i = (d ? 'set' : 'get') + c.charAt(0).toUpperCase() + c.substring(1)
      return this.each(g), h.length ? h.length === 1 ? h[0] : h : this
    }
    return c = a.extend({}, a.fn.wPaint.defaults, c), c.lineWidth = parseInt(c.lineWidth, 10), c.fontSize = parseInt(c.fontSize, 10), this.each(e)
  }, a.fn.wPaint.extend = function (a, d) {
    function e (c) {
      if (d[c]) {
        var e = b.prototype[c],
          f = a[c]
        d[c] = function () { e.apply(this, arguments), f.apply(this, arguments) }
      } else d[c] = a[c]
    }
    var f
    d = d === 'menu' ? c.prototype : b.prototype
    for (f in a) e(f)
  }, a.fn.wPaint.menus = {}, a.fn.wPaint.cursors = {}, a.fn.wPaint.defaults = { path: '/', theme: 'standard classic', autoScaleImage: !0, autoCenterImage: !0, menuHandle: !0, menuOrientation: 'horizontal', menuOffsetLeft: 5, menuOffsetTop: 5, bg: null, image: null, imageStretch: !1, onShapeDown: null, onShapeMove: null, onShapeUp: null }
}(jQuery)),
(function () { String.prototype.capitalize || (String.prototype.capitalize = function () { return this.slice(0, 1).toUpperCase() + this.slice(1) }) }()),
(function (a) {
  a.fn.realWidth = function (b, c, d) {
    var e = null,
      f = null,
      g = null
    return b = b === 'inner' || b === 'outer' ? b : '', g = b === '' ? 'width' : b + 'Width', c = c === !0 ? !0 : !1, f = a(this).clone().css({ position: 'absolute', left: -1e4 }).appendTo(d || 'body'), e = c ? f[g](c) : f[g](), f.remove(), e
  }, a.fn.realHeight = function (b, c, d) {
    var e = null,
      f = null,
      g = null
    return b = b === 'inner' || b === 'outer' ? b : '', g = b === '' ? 'height' : b + 'Height', c = c === !0 ? !0 : !1, f = a(this).clone().css({ position: 'absolute', left: -1e4 }).appendTo(d || 'body'), e = c ? f[g](c) : f[g](), f.remove(), e
  }, a.fn.bindMobileEvents = function () {
    a(this).on('touchstart touchmove touchend touchcancel', function () {
      var a = event.changedTouches || event.originalEvent.targetTouches,
        b = a[0],
        c = ''
      switch (event.type) {
        case 'touchstart':
          c = 'mousedown'
          break
        case 'touchmove':
          c = 'mousemove', event.preventDefault()
          break
        case 'touchend':
          c = 'mouseup'
          break
        default:
          return
      }
      var d = document.createEvent('MouseEvent')
      d.initMouseEvent(c, !0, !0, window, 1, b.screenX, b.screenY, b.clientX, b.clientY, !1, !1, !1, !1, 0, null), b.target.dispatchEvent(d)
    })
  }, a.fn.wPaint.menus.main = {
    img: 'plugins/main/img/icons-menu-main.png',
    items: {
      text: { icon: 'menu', title: wPaintLang.textTool || '文字工具', index: 7, callback: function () { this.setMode('text') } },
      rectangle: { icon: 'activate', title: wPaintLang.rectangleTool || '矩形工具', index: 3, callback: function () { this.setMode('rectangle') } },
      ellipse: { icon: 'activate', title: wPaintLang.ellipseTool || '椭圆工具', index: 4, callback: function () { this.setMode('ellipse') } },
      line: { icon: 'activate', title: wPaintLang.line || '直线', index: 5, callback: function () { this.setMode('line') } },
      pencil: { icon: 'activate', title: wPaintLang.brushTool || '画笔工具', index: 6, callback: function () { this.setMode('pencil') } },
      eraser: { icon: 'activate', title: wPaintLang.Eraser || '橡皮擦', index: 8, callback: function () { this.setMode('eraser') } },
      bucket: { icon: 'activate', title: 'Bucket', index: 9, after: 'lineWidth', callback: function () { this.setMode('bucket') } },
      lineWidth: { icon: 'select', title: wPaintLang.size || '大小', range: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10], value: 2, callback: function (a) { this.setLineWidth(a) } },
      strokeStyle: { icon: 'colorPicker', title: wPaintLang.color || '颜色', callback: function (a) { this.setStrokeStyle(a) } },
      undo: { icon: 'generic', title: wPaintLang.undo || '撤销', index: 0, callback: function () { this.undo() } },
      redo: { icon: 'generic', title: wPaintLang.cancelUndo || '取消撤销', index: 1, callback: function () { this.redo() } },
      clear: { icon: 'generic', title: wPaintLang.clearAll || '全部清除', index: 2, callback: function () { this.clear() } },
      save: { icon: 'generic', title: wPaintLang.save || '保存', index: 0, callback: function () { this.options.saveImg.apply(this, [this.getImage()]) } }
    }
  }, a.extend(a.fn.wPaint.cursors, {
    'default': {
      path: 'plugins/main/img/cursor-crosshair.png',
      left: 7,
      top: 7
    },
    dropper: { path: 'plugins/main/img/cursor-dropper.png', left: 0, top: 12 },
    pencil: { path: 'plugins/main/img/cursor-pencil.png', left: 0, top: 11.99 },
    bucket: { path: 'plugins/main/img/cursor-bucket.png', left: 0, top: 10 },
    eraser1: { path: 'plugins/main/img/cursor-eraser1.png', left: 1, top: 1 },
    eraser2: { path: 'plugins/main/img/cursor-eraser2.png', left: 2, top: 2 },
    eraser3: { path: 'plugins/main/img/cursor-eraser3.png', left: 2, top: 2 },
    eraser4: { path: 'plugins/main/img/cursor-eraser4.png', left: 3, top: 3 },
    eraser5: { path: 'plugins/main/img/cursor-eraser5.png', left: 3, top: 3 },
    eraser6: { path: 'plugins/main/img/cursor-eraser6.png', left: 4, top: 4 },
    eraser7: { path: 'plugins/main/img/cursor-eraser7.png', left: 4, top: 4 },
    eraser8: { path: 'plugins/main/img/cursor-eraser8.png', left: 5, top: 5 },
    eraser9: { path: 'plugins/main/img/cursor-eraser9.png', left: 5, top: 5 },
    eraser10: { path: 'plugins/main/img/cursor-eraser10.png', left: 6, top: 6 }
  }), a.extend(a.fn.wPaint.defaults, { saveImg: null, mode: 'pencil', lineWidth: '3', fillStyle: '#FFFFFF', strokeStyle: '#FFFF00' }), a.fn.wPaint.extend({
    undoCurrent: -1,
    undoArray: [],
    setUndoFlag: !0,
    generate: function () { this.menus.all.main = this._createMenu('main', { offsetLeft: this.options.menuOffsetLeft, offsetTop: this.options.menuOffsetTop }) },
    _init: function () { this._addUndo(), this.menus.all.main._setIconDisabled('clear', !0) },
    setStrokeStyle: function (a) { this.options.strokeStyle = a, this.menus.all.main._setColorPickerValue('strokeStyle', a) },
    setLineWidth: function (a) { this.options.lineWidth = a, this.menus.all.main._setSelectValue('lineWidth', a), this.setCursor(this.options.mode) },
    setFillStyle: function (a) { this.options.fillStyle = a, this.menus.all.main._setColorPickerValue('fillStyle', a) },
    setCursor: function (a) { a === 'eraser' && this.setCursor('eraser' + this.options.lineWidth) },
    undo: function () { this.undoArray[this.undoCurrent - 1] && this._setUndo(--this.undoCurrent), this._undoToggleIcons() },
    redo: function () { this.undoArray[this.undoCurrent + 1] && this._setUndo(++this.undoCurrent), this._undoToggleIcons() },
    _addUndo: function () {
      for (this.undoCurrent < this.undoArray.length - 1 ? this.undoArray[++this.undoCurrent] = this.getImage(!1) : (this.undoArray.push(this.getImage(!1)), this.undoArray.length > this.undoMax ? this.undoArray = this.undoArray.slice(1, this.undoArray.length) : this.undoCurrent++); this.undoCurrent !== this.undoArray.length - 1 && this.undoArray.length !== 0;) this.undoArray.pop()
      this._undoToggleIcons(), this.menus.all.main._setIconDisabled('clear', !1)
    },
    _showFileModal: function (b, c) {
      function d (a, b) {
        function c (c) { c.stopPropagation(), a === 'fg' ? e.setImage(b) : a === 'bg' && e.setBg(b, null, null, !0) } g.on('click', c)
      }
      for (var e = this, f = a('<div></div>'), g = null, h = 0, i = c.length; i > h; h++) g = a('<img class="wPaint-modal-img"/>').attr('src', c[h]), g = a('<div class="wPaint-modal-img-holder"></div>').append(g), d(b, c[h]), f.append(g)
      this._showModal(f)
    },
    _undoToggleIcons: function () {
      var a = this.undoCurrent > 0 && this.undoArray.length > 1 ? 0 : 1,
        b = this.undoCurrent < this.undoArray.length - 1 ? 2 : 3
      this.menus.all.main._setIconDisabled('undo', a === 1 ? !0 : !1), this.menus.all.main._setIconDisabled('redo', b === 3 ? !0 : !1)
    },
    _setUndo: function (a) { this.setImage(this.undoArray[a], null, null, !0) },
    clear: function () { this.menus.all.main._isIconDisabled('clear') || (this.ctx.clearRect(0, 0, this.width, this.height), this._addUndo(), this.menus.all.main._setIconDisabled('clear', !0)) },
    _drawRectangleDown: function (a) { this._drawShapeDown(a) },
    _drawRectangleMove: function (a) { this._drawShapeMove(a), this.ctxTemp.beginPath(), this.ctxTemp.rect(a.x, a.y, a.w, a.h), this.ctx.closePath(), this.ctxTemp.stroke() },
    _drawRectangleUp: function (a) { this._drawShapeUp(a), this._addUndo() },
    _drawEllipseDown: function (a) { this._drawShapeDown(a) },
    _drawEllipseMove: function (a) { this._drawShapeMove(a), this.ctxTemp.ellipse(a.x, a.y, a.w, a.h), this.ctxTemp.stroke() },
    _drawEllipseUp: function (a) { this._drawShapeUp(a), this._addUndo() },
    _drawLineDown: function (a) { this._drawShapeDown(a) },
    _drawLineMove: function (a) {
      this._drawShapeMove(a, 1)
      var b = this.canvasTempLeftOriginal,
        c = this.canvasTempTopOriginal
      a.pageX < b && (a.x = a.x + a.w, a.w = -1 * a.w), a.pageY < c && (a.y = a.y + a.h, a.h = -1 * a.h), this.ctxTemp.lineJoin = 'round', this.ctxTemp.beginPath(), this.ctxTemp.moveTo(a.x, a.y), this.ctxTemp.lineTo(a.x + a.w, a.y + a.h), this.ctxTemp.closePath(), this.ctxTemp.stroke()
    },
    _drawLineUp: function (a) { this._drawShapeUp(a), this._addUndo() },
    _drawPencilDown: function (a) { this.ctx.lineJoin = 'round', this.ctx.lineCap = 'round', this.ctx.strokeStyle = this.options.strokeStyle, this.ctx.fillStyle = this.options.strokeStyle, this.ctx.lineWidth = this.options.lineWidth, this.ctx.beginPath(), this.ctx.arc(a.pageX, a.pageY, this.options.lineWidth / 2, 0, 2 * Math.PI, !0), this.ctx.closePath(), this.ctx.fill(), this.ctx.beginPath(), this.ctx.moveTo(a.pageX, a.pageY) },
    _drawPencilMove: function (a) { this.ctx.lineTo(a.pageX, a.pageY), this.ctx.stroke() },
    _drawPencilUp: function () { this.ctx.closePath(), this._addUndo() },
    _drawEraserDown: function (a) { this.ctx.save(), this.ctx.globalCompositeOperation = 'destination-out', this._drawPencilDown(a) },
    _drawEraserMove: function (a) { this._drawPencilMove(a) },
    _drawEraserUp: function (a) { this._drawPencilUp(a), this.ctx.restore() },
    _drawBucketDown: function (a) { this.ctx.fillArea(a.pageX, a.pageY, this.options.fillStyle), this._addUndo() }
  }), a.fn.wPaint.menus.text = {
    img: 'plugins/main/img/icons-menu-text.png',
    items: {
      bold: { icon: 'toggle', title: wPaintLang.bold || '粗体', index: 0, callback: function (a) { this.setFontBold(a) } },
      italic: { icon: 'toggle', title: wPaintLang.italic || '斜体', index: 1, callback: function (a) { this.setFontItalic(a) } },
      fontSize: { title: wPaintLang.fontSize1 || '字体大小', icon: 'select', range: [8, 9, 10, 12, 14, 16, 20, 24, 30], value: 12, callback: function (a) { this.setFontSize(a) } },
      fillStyle: { title: wPaintLang.fontColor || '字体颜色', icon: 'colorPicker', callback: function (a) { this.setFillStyle(a) } },
      fontFamily: { icon: 'select', title: wPaintLang.fontType || '字体类型', range: ['Arial', 'Courier', 'Times', 'Verdana'], useRange: !0, value: 'Arial', callback: function (a) { this.setFontFamily(a) } }
    }
  }, /* a.fn.wPaint.menus.main.items.text={icon:"menu",after:"pencil",title:"文字工具",index:7,callback:function(){this.setMode("text")}}, */ a.extend(a.fn.wPaint.defaults, { fontSize: '12', fontFamily: 'Arial', fontBold: !1, fontItalic: !1, fontUnderline: !1 }), a.fn.wPaint.extend({
    generate: function () { this.$textCalc = a('<div></div>').hide(), this.$textInput = a('<textarea class="wPaint-text-input" spellcheck="false"></textarea>').on('mousedown', this._stopPropagation).css({ position: 'absolute' }).hide(), a('body').append(this.$textCalc), this.$el.append(this.$textInput), this.menus.all.text = this._createMenu('text') },
    _init: function () {
      function b () { c._drawTextIfNotEmpty(), c.$textInput.hide(), c.$canvasTemp.hide() }
      var c = this
      for (var d in this.menus.all) this.menus.all[d].$menu.on('click', b).on('mousedown', this._stopPropagation)
      a(document).on('mousedown', b)
    },
    setFillStyle: function (a) { this.$textInput.css('color', a) },
    setFontSize: function (a) { this.options.fontSize = parseInt(a, 10), this._setFont({ fontSize: a + 'px', lineHeight: a + 'px' }), this.menus.all.text._setSelectValue('fontSize', a) },
    setFillStyle: function (a) { this.options.fillStyle = a, this.menus.all.text._setColorPickerValue('fillStyle', a), this.$textInput.css('color', a) },
    setFontFamily: function (a) { this.options.fontFamily = a, this._setFont({ fontFamily: a }), this.menus.all.text._setSelectValue('fontFamily', a) },
    setFontBold: function (a) { this.options.fontBold = a, this._setFont({ fontWeight: a ? 'bold' : '' }) },
    setFontItalic: function (a) { this.options.fontItalic = a, this._setFont({ fontStyle: a ? 'italic' : '' }) },
    setFontUnderline: function (a) { this.options.fontUnderline = a, this._setFont({ fontWeight: a ? 'underline' : '' }) },
    _setFont: function (a) { this.$textInput.css(a), this.$textCalc.css(a) },
    _drawTextDown: function (a) { this._drawTextIfNotEmpty(), this._drawShapeDown(a, 1), this.$textInput.css({ left: a.pageX - 1, top: a.pageY - 1, width: 160, height: 40 }).show().focus() },
    _drawTextMove: function (a) { this._drawShapeMove(a, 1), this.$textInput.css({ left: a.left - 1, top: a.top - 1, width: (a.width > 160 ? a.width : 160), height: (a.height > 40 ? a.height : 40) }) },
    _drawTextIfNotEmpty: function () { this.$textInput.val() !== '' && this._drawText() },
    _drawText: function () {
      var a, b, c, d, e = '',
        f = this.$textInput.val().split('\n'),
        g = [],
        h = this.$textInput.width() - 2,
        i = 0,
        j = 0,
        k = this.$textInput.position(),
        l = k.left + 1,
        m = k.top + 1
      for (this.options.fontItalic && (e += 'italic '), this.options.fontBold && (e += 'bold '), e += this.options.fontSize + 'px ' + this.options.fontFamily, a = 0, b = f.length; b > a; a++) {
        for (this.$textCalc.html(''), j = 0, c = 0, d = f[0].length; d > c; c++) i = this.$textCalc.append(f[a][c]).width(), i > h && (g.push(f[a].substring(j, c)), j = c, this.$textCalc.html(f[a][c]))
        j !== c && g.push(f[a].substring(j, c))
      }
      for (f = this.$textInput.val(g.join('\n')).val().split('\n'), a = 0, b = f.length; b > a; a++) this.ctx.fillStyle = this.options.fillStyle, this.ctx.textBaseline = 'top', this.ctx.font = e, this.ctx.fillText(f[a], l, m), m += this.options.fontSize
      this.$textInput.val(''), this._addUndo()
    }
  }),
    (function init () {
      $.fn.wPaint.menus.main = {
        img: 'plugins/main/img/icons-menu-main.png',
        items: {
          text: {
            icon: 'menu',
            title: wPaintLang.textTool || '文字工具',
            index: 7,
            callback: function () {
              this.setFontSize(20)
              this.setFillStyle('#FF0000')
              this.setMode('text')
            }
          },
          // fillStyle: {
          //   title: 'Fill Color',
          //   icon: 'colorPicker',
          //   callback: function(color) { this.setFillStyle(color); }
          // },
          rectangleMenu: {
            icon: 'menu',
            title: wPaintLang.rectangleTool || '矩形工具',
            index: 3,
            callback: function () {
              this.setLineWidth(2)
              this.setStrokeStyle('#FF0000')
              this.setFillStyle('transparent')
              this.setMode('rectangleMenu')
            }
          },
          ellipseMenu: {
            icon: 'menu',
            title: wPaintLang.ellipseTool || '椭圆工具',
            index: 4,
            callback: function () {
              this.setLineWidth(2)
              this.setStrokeStyle('#FF0000')
              this.setFillStyle('transparent')
              this.setMode('ellipseMenu')
            }
          },
          lineMenu: {
            icon: 'menu',
            title: wPaintLang.line || '直线',
            index: 5,
            callback: function () {
              this.setLineWidth(3)
              this.setStrokeStyle('#FF0000')
              this.setMode('lineMenu')
            }
          },
          pencilMenu: {
            icon: 'menu',
            title: wPaintLang.brushTool || '画笔工具',
            index: 6,
            callback: function () {
              this.setLineWidth(3)
              this.setStrokeStyle('#FF0000')
              this.setMode('pencilMenu')
            }
          },
          // strokeStyle: {
          //   icon: 'colorPicker',
          //   title: 'Stroke Color',
          //   callback: function(color) { this.setStrokeStyle(color); }
          // },
          // eraser: {
          //   icon: 'activate',
          //   title: '橡皮擦',
          //   index: 8,
          //   callback: function() { this.setMode('eraser'); }
          // },
          undo: {
            icon: 'generic',
            title: wPaintLang.undo || '撤销',
            index: 0,
            callback: function () { this.undo() }
          },
          redo: {
            icon: 'generic',
            title: wPaintLang.cancelUndo || '取消撤销',
            index: 1,
            callback: function () { this.redo() }
          },
          clear: {
            icon: 'generic',
            title: wPaintLang.clearAll || '清除',
            index: 2,
            callback: function () { this.clear() }
          },
          save: {
            icon: 'generic',
            title: wPaintLang.save || '保存',
            index: 0,
            callback: function () { this.options.saveImg.apply(this, [this.getImage()]) }
          }
        }
      }
      $.fn.wPaint.menus.text = {
        img: 'plugins/text/img/icons-menu-text.png',
        items: {
          // bold: {
          //   icon: 'toggle',
          //   title: 'Bold',
          //   index: 0,
          //   callback: function(toggle) { this.setFontBold(toggle); }
          // },
          // italic: {
          //   icon: 'toggle',
          //   title: 'Italic',
          //   index: 1,
          //   callback: function(toggle) { this.setFontItalic(toggle); }
          // },
          fontSize1: {
            icon: 'generic',
            title: wPaintLang.fontSize || '字号' + ' 16',
            index: 0,
            callback: function (toggle) { this.setFontSize(16) }
          },
          fontSize2: {
            icon: 'generic',
            title: wPaintLang.fontSize || '字号' + ' 20',
            index: 0,
            callback: function (toggle) { this.setFontSize(20) }
          },
          fontSize3: {
            icon: 'generic',
            title: wPaintLang.fontSize || '字号' + ' 24',
            index: 0,
            callback: function (toggle) { this.setFontSize(24) }
          },
          color1: {
            icon: 'generic',
            title: wPaintLang.red || '红色',
            index: 0,
            callback: function (toggle) { this.setFillStyle('#FF0000') }
          },
          color2: {
            icon: 'generic',
            title: wPaintLang.yellow || '黄色',
            index: 0,
            callback: function (toggle) { this.setFillStyle('#CCFF00') }
          },
          color3: {
            icon: 'generic',
            title: wPaintLang.blue || '蓝色',
            index: 0,
            callback: function (toggle) { this.setFillStyle('#385AD3') }
          },
          color4: {
            icon: 'generic',
            title: wPaintLang.purple || '紫色',
            index: 0,
            callback: function (toggle) { this.setFillStyle('#F31BF3') }
          },
          color5: {
            icon: 'generic',
            title: wPaintLang.cyan || '青色',
            index: 0,
            callback: function (toggle) { this.setFillStyle('#16DCDC') }
          },
          fontSize: {
            title: wPaintLang.fontSize || '字号',
            icon: 'select',
            range: [8, 9, 10, 12, 14, 16, 20, 24, 30],
            value: 12,
            callback: function (size) { this.setFontSize(size) }
          },
          fillStyle: {
            title: wPaintLang.color || '颜色',
            icon: 'colorPicker',
            callback: function (color) { this.setFillStyle(color) }
          }
        }
      }
      $.fn.wPaint.menus.rectangleMenu = {
        img: 'plugins/text/img/icons-menu-text.png',
        items: {
          lineWidth1: {
            icon: 'generic',
            title: wPaintLang.lineWidth || '线宽' + ' 1',
            index: 0,
            callback: function (toggle) { this.setLineWidth(1) }
          },
          lineWidth2: {
            icon: 'generic',
            title: wPaintLang.lineWidth || '线宽' + ' 2',
            index: 0,
            callback: function (toggle) { this.setLineWidth(2) }
          },
          lineWidth3: {
            icon: 'generic',
            title: wPaintLang.lineWidth || '线宽' + ' 3',
            index: 0,
            callback: function (toggle) { this.setLineWidth(3) }
          },
          color1: {
            icon: 'generic',
            title: wPaintLang.red || '红色',
            index: 0,
            callback: function (toggle) { this.setStrokeStyle('#FF0000') }
          },
          color2: {
            icon: 'generic',
            title: wPaintLang.yellow || '黄色',
            index: 0,
            callback: function (toggle) { this.setStrokeStyle('#CCFF00') }
          },
          color3: {
            icon: 'generic',
            title: wPaintLang.blue || '蓝色',
            index: 0,
            callback: function (toggle) { this.setStrokeStyle('#385AD3') }
          },
          color4: {
            icon: 'generic',
            title: wPaintLang.purple || '紫色',
            index: 0,
            callback: function (toggle) { this.setStrokeStyle('#F31BF3') }
          },
          color5: {
            icon: 'generic',
            title: wPaintLang.cyan || '青色',
            index: 0,
            callback: function (toggle) { this.setStrokeStyle('#16DCDC') }
          },
          lineWidth: {
            icon: 'select',
            title: wPaintLang.lineWidth || '线宽',
            range: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10],
            value: 2,
            callback: function (width) { this.setLineWidth(width) }
          },
          strokeStyle: {
            icon: 'colorPicker',
            title: wPaintLang.color || '颜色',
            callback: function (color) { this.setStrokeStyle(color) }
          }
        }
      }
      $.fn.wPaint.menus.ellipseMenu = $.fn.wPaint.menus.rectangleMenu
      $.fn.wPaint.menus.lineMenu = {
        img: 'plugins/text/img/icons-menu-text.png',
        items: {
          lineWidth3: {
            icon: 'generic',
            title: wPaintLang.lineWidth || '线宽' + ' 3',
            index: 0,
            callback: function (toggle) { this.setLineWidth(3) }
          },
          lineWidth5: {
            icon: 'generic',
            title: wPaintLang.lineWidth || '线宽' + ' 5',
            index: 0,
            callback: function (toggle) { this.setLineWidth(5) }
          },
          lineWidth7: {
            icon: 'generic',
            title: wPaintLang.lineWidth || '线宽' + ' 7',
            index: 0,
            callback: function (toggle) { this.setLineWidth(7) }
          },
          color1: {
            icon: 'generic',
            title: wPaintLang.red || '红色',
            index: 0,
            callback: function (toggle) { this.setStrokeStyle('#FF0000') }
          },
          color2: {
            icon: 'generic',
            title: wPaintLang.yellow || '黄色',
            index: 0,
            callback: function (toggle) { this.setStrokeStyle('#CCFF00') }
          },
          color3: {
            icon: 'generic',
            title: wPaintLang.blue || '蓝色',
            index: 0,
            callback: function (toggle) { this.setStrokeStyle('#385AD3') }
          },
          color4: {
            icon: 'generic',
            title: wPaintLang.purple || '紫色',
            index: 0,
            callback: function (toggle) { this.setStrokeStyle('#F31BF3') }
          },
          color5: {
            icon: 'generic',
            title: wPaintLang.cyan || '青色',
            index: 0,
            callback: function (toggle) { this.setStrokeStyle('#16DCDC') }
          },
          lineWidth: {
            icon: 'select',
            title: wPaintLang.lineWidth || '线宽',
            range: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10],
            value: 2,
            callback: function (width) { this.setLineWidth(width) }
          },
          strokeStyle: {
            icon: 'colorPicker',
            title: wPaintLang.color || '颜色',
            callback: function (color) { this.setStrokeStyle(color) }
          }
        }
      }
      $.fn.wPaint.menus.pencilMenu = $.fn.wPaint.menus.lineMenu

      $.fn.wPaint.extend({
        generate: function () {
          this.menus.all.rectangleMenu = this._createMenu('rectangleMenu')
          this.menus.all.ellipseMenu = this._createMenu('ellipseMenu')
          this.menus.all.lineMenu = this._createMenu('lineMenu')
          this.menus.all.pencilMenu = this._createMenu('pencilMenu')
        },

        _init: function () {
          var _this = this

          function inputClick () {
            _this._drawTextIfNotEmpty()
            _this.$textInput.hide()
            _this.$canvasTemp.hide()
          }

          // in case we click on another element while typing - just auto set the text
          for (var i in this.menus.all) {
            this.menus.all[i].$menu
              .on('click', inputClick)
              .on('mousedown', this._stopPropagation)
          }

          // same idea here for clicking outside of the canvas area
          $(document).on('mousedown', inputClick)
        },

        /****************************************
         * rectangle
         ****************************************/
        _drawRectangleMenuDown: function (e) { this._drawShapeDown(e) },

        _drawRectangleMenuMove: function (e) {
          this._drawShapeMove(e)

          this.ctxTemp.rect(e.x, e.y, e.w, e.h)
          this.ctxTemp.stroke()
          this.ctxTemp.fill()
        },

        _drawRectangleMenuUp: function (e) {
          this._drawShapeUp(e)
          this._addUndo()
        },

        /****************************************
         * ellipse
         ****************************************/
        _drawEllipseMenuDown: function (e) { this._drawShapeDown(e) },

        _drawEllipseMenuMove: function (e) {
          this._drawShapeMove(e)

          this.ctxTemp.ellipse(e.x, e.y, e.w, e.h)
          this.ctxTemp.stroke()
          this.ctxTemp.fill()
        },

        _drawEllipseMenuUp: function (e) {
          this._drawShapeUp(e)
          this._addUndo()
        },

        /****************************************
         * line
         ****************************************/
        _drawLineMenuDown: function (e) { this._drawShapeDown(e) },

        _drawLineMenuMove: function (e) {
          this._drawShapeMove(e, 1)

          var xo = this.canvasTempLeftOriginal
          var yo = this.canvasTempTopOriginal

          if (e.pageX < xo) {
            e.x = e.x + e.w
            e.w = e.w * -1
          }
          if (e.pageY < yo) {
            e.y = e.y + e.h
            e.h = e.h * -1
          }

          this.ctxTemp.lineJoin = 'round'
          this.ctxTemp.beginPath()
          this.ctxTemp.moveTo(e.x, e.y)
          this.ctxTemp.lineTo(e.x + e.w, e.y + e.h)
          this.ctxTemp.closePath()
          this.ctxTemp.stroke()
        },

        _drawLineMenuUp: function (e) {
          this._drawShapeUp(e)
          this._addUndo()
        },

        /****************************************
         * pencil
         ****************************************/
        _drawPencilMenuDown: function (e) {
          this.ctx.lineJoin = 'round'
          this.ctx.lineCap = 'round'
          this.ctx.strokeStyle = this.options.strokeStyle
          this.ctx.fillStyle = this.options.strokeStyle
          this.ctx.lineWidth = this.options.lineWidth

          // draw single dot in case of a click without a move
          this.ctx.beginPath()
          this.ctx.arc(e.pageX, e.pageY, this.options.lineWidth / 2, 0, Math.PI * 2, true)
          this.ctx.closePath()
          this.ctx.fill()

          // start the path for a drag
          this.ctx.beginPath()
          this.ctx.moveTo(e.pageX, e.pageY)
        },

        _drawPencilMenuMove: function (e) {
          this.ctx.lineTo(e.pageX, e.pageY)
          this.ctx.stroke()
        },

        _drawPencilMenuUp: function () {
          this.ctx.closePath()
          this._addUndo()
        },

        setStrokeStyle: function (color) {
          this.options.strokeStyle = color
          for (var m in this.menus.all) {
            try {
              this.menus.all[m]._setColorPickerValue('strokeStyle', color)
            } catch (e) {}
          }

          $('.wPaint-menu-icon-name-color1, .wPaint-menu-icon-name-color2, .wPaint-menu-icon-name-color3, .wPaint-menu-icon-name-color4, .wPaint-menu-icon-name-color5')
            .removeClass('active')
          switch (color) {
            case '#FF0000':
              $('.wPaint-menu-icon-name-color1').addClass('active')
              break
            case '#CCFF00':
              $('.wPaint-menu-icon-name-color2').addClass('active')
              break
            case '#385AD3':
              $('.wPaint-menu-icon-name-color3').addClass('active')
              break
            case '#F31BF3':
              $('.wPaint-menu-icon-name-color4').addClass('active')
              break
            case '#16DCDC':
              $('.wPaint-menu-icon-name-color5').addClass('active')
              break
          }
        },

        setLineWidth: function (width) {
          this.options.lineWidth = width
          for (var m in this.menus.all) {
            try {
              this.menus.all[m]._setSelectValue('lineWidth', width)
            } catch (e) {}
          }

          // reset cursor here based on mode in case we need to update cursor (for instance when changing cursor for eraser sizes)
          this.setCursor(this.options.mode)

          $('.wPaint-menu-icon-name-lineWidth1, .wPaint-menu-icon-name-lineWidth2, .wPaint-menu-icon-name-lineWidth3, .wPaint-menu-icon-name-lineWidth5, .wPaint-menu-icon-name-lineWidth7')
            .removeClass('active')
          switch (width) {
            case 1:
              $('.wPaint-menu-icon-name-lineWidth1').addClass('active')
              break
            case 2:
              $('.wPaint-menu-icon-name-lineWidth2').addClass('active')
              break
            case 3:
              $('.wPaint-menu-icon-name-lineWidth3').addClass('active')
              break
            case 5:
              $('.wPaint-menu-icon-name-lineWidth5').addClass('active')
              break
            case 7:
              $('.wPaint-menu-icon-name-lineWidth7').addClass('active')
              break
          }
        },

        setFillStyle: function (color) {
          this.options.fillStyle = color
          for (var m in this.menus.all) {
            try {
              this.menus.all[m]._setColorPickerValue('fillStyle', color)
            } catch (e) {}
          }

          $('.wPaint-menu-icon-name-color1, .wPaint-menu-icon-name-color2, .wPaint-menu-icon-name-color3, .wPaint-menu-icon-name-color4, .wPaint-menu-icon-name-color5')
            .removeClass('active')
          switch (color) {
            case '#FF0000':
              $('.wPaint-menu-icon-name-color1').addClass('active')
              break
            case '#CCFF00':
              $('.wPaint-menu-icon-name-color2').addClass('active')
              break
            case '#385AD3':
              $('.wPaint-menu-icon-name-color3').addClass('active')
              break
            case '#F31BF3':
              $('.wPaint-menu-icon-name-color4').addClass('active')
              break
            case '#16DCDC':
              $('.wPaint-menu-icon-name-color5').addClass('active')
              break
          }
        },

        setFontSize: function (a) {
          this.options.fontSize = parseInt(a, 10),
            this._setFont({ fontSize: a + 'px', lineHeight: a + 'px' }),
            this.menus.all.text._setSelectValue('fontSize', a)

          $('.wPaint-menu-icon-name-fontSize1, .wPaint-menu-icon-name-fontSize2, .wPaint-menu-icon-name-fontSize3').removeClass('active')
          switch (a) {
            case 16:
              $('.wPaint-menu-icon-name-fontSize1').addClass('active')
              break
            case 20:
              $('.wPaint-menu-icon-name-fontSize2').addClass('active')
              break
            case 24:
              $('.wPaint-menu-icon-name-fontSize3').addClass('active')
              break
          }
        }

      })
    })()
}(jQuery)), !(function () {
  window.CanvasRenderingContext2D && (CanvasRenderingContext2D.prototype.fillArea = function (a, b, c) {
    function d (a) { return { r: p[a], g: p[a + 1], b: p[a + 2], a: p[a + 3] } }

    function e (a) { p[a] = c.r, p[a + 1] = c.g, p[a + 2] = c.b, p[a + 3] = c.a }

    function f (a) { return g.r === a.r && g.g === a.g && g.b === a.b && g.a === a.a }
    if (!a || !b || !c) return !0
    var g, h, i, j, k, l, m = this.canvas.width,
      n = this.canvas.height,
      o = this.getImageData(0, 0, m, n),
      p = o.data,
      q = [
        [a, b]
      ]
    if (g = d(4 * (b * m + a)), l = this.canvas.style.color, this.canvas.style.color = c, c = this.canvas.style.color.match(/^rgba?\((.*)\);?$/)[1].split(','), this.canvas.style.color = l, c = { r: parseInt(c[0], 10), g: parseInt(c[1], 10), b: parseInt(c[2], 10), a: parseInt(c[3] || 255, 10) }, f(c)) return !0
    for (; q.length;) { for (h = q.pop(), i = 4 * (h[1] * m + h[0]); h[1]-- >= 0 && f(d(i));) i -= 4 * m; for (i += 4 * m, ++h[1], j = !1, k = !1; h[1]++ < n - 1 && f(d(i));) e(i), h[0] > 0 && (f(d(i - 4)) ? j || (q.push([h[0] - 1, h[1]]), j = !0) : j && (j = !1)), h[0] < m - 1 && (f(d(i + 4)) ? k || (q.push([h[0] + 1, h[1]]), k = !0) : k && (k = !1)), i += 4 * m } this.putImageData(o, 0, 0)
  })
}())

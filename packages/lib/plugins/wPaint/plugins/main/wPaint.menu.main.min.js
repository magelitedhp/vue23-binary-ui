/*! wPaint - v2.5.0 - 2020-07-18 */
!function(t){t.fn.wPaint.menus.main={img:"plugins/main/img/icons-menu-main.png",items:{undo:{icon:"generic",title:"Undo",index:0,callback:function(){this.undo()}},redo:{icon:"generic",title:"Redo",index:1,callback:function(){this.redo()}},clear:{icon:"generic",title:"Clear",index:2,callback:function(){this.clear()}},rectangle:{icon:"activate",title:"Rectangle",index:3,callback:function(){this.setMode("rectangle")}},ellipse:{icon:"activate",title:"Ellipse",index:4,callback:function(){this.setMode("ellipse")}},line:{icon:"activate",title:"Line",index:5,callback:function(){this.setMode("line")}},pencil:{icon:"activate",title:"Pencil",index:6,callback:function(){this.setMode("pencil")}},lineWidth:{icon:"select",title:"Stroke Width",range:[1,2,3,4,5,6,7,8,9,10],value:2,callback:function(t){this.setLineWidth(t)}},strokeStyle:{icon:"colorPicker",title:"Stroke Color",callback:function(t){this.setStrokeStyle(t)}}}},t.extend(t.fn.wPaint.cursors,{default:{path:"plugins/main/img/cursor-crosshair.png",left:7,top:7},dropper:{path:"plugins/main/img/cursor-dropper.png",left:0,top:12},pencil:{path:"plugins/main/img/cursor-pencil.png",left:0,top:11.99},bucket:{path:"plugins/main/img/cursor-bucket.png",left:0,top:10},eraser1:{path:"plugins/main/img/cursor-eraser1.png",left:1,top:1},eraser2:{path:"plugins/main/img/cursor-eraser2.png",left:2,top:2},eraser3:{path:"plugins/main/img/cursor-eraser3.png",left:2,top:2},eraser4:{path:"plugins/main/img/cursor-eraser4.png",left:3,top:3},eraser5:{path:"plugins/main/img/cursor-eraser5.png",left:3,top:3},eraser6:{path:"plugins/main/img/cursor-eraser6.png",left:4,top:4},eraser7:{path:"plugins/main/img/cursor-eraser7.png",left:4,top:4},eraser8:{path:"plugins/main/img/cursor-eraser8.png",left:5,top:5},eraser9:{path:"plugins/main/img/cursor-eraser9.png",left:5,top:5},eraser10:{path:"plugins/main/img/cursor-eraser10.png",left:6,top:6}}),t.extend(t.fn.wPaint.defaults,{mode:"pencil",lineWidth:"3",fillStyle:"transparent",strokeStyle:"#FFFF00"}),t.fn.wPaint.extend({undoCurrent:-1,undoArray:[],points:[],beginPoint:null,setUndoFlag:!0,generate:function(){this.menus.all.main=this._createMenu("main",{offsetLeft:this.options.menuOffsetLeft,offsetTop:this.options.menuOffsetTop})},_init:function(){this._addUndo(),this.menus.all.main._setIconDisabled("clear",!0)},setStrokeStyle:function(t){this.options.strokeStyle=t,this.menus.all.main._setColorPickerValue("strokeStyle",t)},setLineWidth:function(t){this.options.lineWidth=t,this.menus.all.main._setSelectValue("lineWidth",t),this.setCursor(this.options.mode)},setFillStyle:function(t){this.options.fillStyle=t,this.menus.all.main._setColorPickerValue("fillStyle",t)},setCursor:function(t){"eraser"===t&&this.setCursor("eraser"+this.options.lineWidth)},undo:function(){this.undoArray[this.undoCurrent-1]&&this._setUndo(--this.undoCurrent),this._undoToggleIcons()},redo:function(){this.undoArray[this.undoCurrent+1]&&this._setUndo(++this.undoCurrent),this._undoToggleIcons()},_addUndo:function(){for(this.undoCurrent<this.undoArray.length-1?this.undoArray[++this.undoCurrent]=this.getImage(!1):(this.undoArray.push(this.getImage(!1)),this.undoArray.length>this.undoMax?this.undoArray=this.undoArray.slice(1,this.undoArray.length):this.undoCurrent++);this.undoCurrent!==this.undoArray.length-1&&0!==this.undoArray.length;)this.undoArray.pop();this._undoToggleIcons(),this.menus.all.main._setIconDisabled("clear",!1)},_undoToggleIcons:function(){var t=0<this.undoCurrent&&1<this.undoArray.length?0:1,e=this.undoCurrent<this.undoArray.length-1?2:3;this.menus.all.main._setIconDisabled("undo",1==t),this.menus.all.main._setIconDisabled("redo",3==e)},_setUndo:function(t){this.setImage(this.undoArray[t],null,null,!0)},clear:function(){this.menus.all.main._isIconDisabled("clear")||(this.ctx.clearRect(0,0,this.width,this.height),this._addUndo(),this.menus.all.main._setIconDisabled("clear",!0))},_drawRectangleDown:function(t){this._drawShapeDown(t)},_drawRectangleMove:function(t){this._drawShapeMove(t),this.ctxTemp.rect(t.x,t.y,t.w,t.h),this.ctxTemp.stroke(),this.ctxTemp.fill()},_drawRectangleUp:function(t){this._drawShapeUp(t),this._addUndo()},_drawEllipseDown:function(t){this._drawShapeDown(t)},_drawEllipseMove:function(t){this._drawShapeMove(t),this.ctxTemp.ellipse(t.x,t.y,t.w,t.h),this.ctxTemp.stroke(),this.ctxTemp.fill()},_drawEllipseUp:function(t){this._drawShapeUp(t),this._addUndo()},_drawLineDown:function(t){this._drawShapeDown(t)},_drawLineMove:function(t){this._drawShapeMove(t,1);var e=this.canvasTempLeftOriginal,i=this.canvasTempTopOriginal;t.pageX<e&&(t.x=t.x+t.w,t.w=-1*t.w),t.pageY<i&&(t.y=t.y+t.h,t.h=-1*t.h),this.ctxTemp.lineJoin="round",this.ctxTemp.beginPath(),this.ctxTemp.moveTo(t.x,t.y),this.ctxTemp.lineTo(t.x+t.w,t.y+t.h),this.ctxTemp.closePath(),this.ctxTemp.stroke()},_drawLineUp:function(t){this._drawShapeUp(t),this._addUndo()},_drawPencilDown:function(t){this.ctx.lineJoin="round",this.ctx.lineCap="round",this.ctx.strokeStyle=this.options.strokeStyle,this.ctx.fillStyle=this.options.strokeStyle,this.ctx.lineWidth=this.options.lineWidth,this.ctx.beginPath(),this.ctx.moveTo(t.pageX,t.pageY),this.beginPoint={x:t.pageX,y:t.pageY},this.points=[],this.points.push(this.beginPoint)},_drawPencilMove:function(t){var e,i,n;this.points.push({x:t.pageX,y:t.pageY}),3<this.points.length&&(i=(e=this.points.slice(-2))[0],n={x:(e[0].x+e[1].x)/2,y:(e[0].y+e[1].y)/2},this.drawBezierCurve(this.beginPoint,i,n),this.beginPoint=n)},drawBezierCurve:function(t,e,i){this.ctx.quadraticCurveTo(e.x,e.y,i.x,i.y),this.ctx.stroke()},_drawPencilUp:function(){this.ctx.closePath(),this._addUndo()},_drawEraserDown:function(t){this.ctx.save(),this.ctx.globalCompositeOperation="destination-out",this._drawPencilDown(t)},_drawEraserMove:function(t){this._drawPencilMove(t)},_drawEraserUp:function(t){this._drawPencilUp(t),this.ctx.restore()},_drawBucketDown:function(t){this.ctx.fillArea(t.pageX,t.pageY,this.options.fillStyle),this._addUndo()}})}(jQuery),window.CanvasRenderingContext2D&&(CanvasRenderingContext2D.prototype.fillArea=function(t,e,i){function n(t){return{r:d[t],g:d[t+1],b:d[t+2],a:d[t+3]}}function s(t){return f.r===t.r&&f.g===t.g&&f.b===t.b&&f.a===t.a}if(!t||!e||!i)return!0;var o,a,r,l,h,c=this.canvas.width,u=this.canvas.height,p=this.getImageData(0,0,c,u),d=p.data,g=[[t,e]],f=n(4*(e*c+t)),m=this.canvas.style.color;if(this.canvas.style.color=i,i=this.canvas.style.color.match(/^rgba?\((.*)\);?$/)[1].split(","),this.canvas.style.color=m,s(i={r:parseInt(i[0],10),g:parseInt(i[1],10),b:parseInt(i[2],10),a:parseInt(i[3]||255,10)}))return!0;for(;g.length;){for(a=4*((o=g.pop())[1]*c+o[0]);0<=o[1]--&&s(n(a));)a-=4*c;for(a+=4*c,++o[1],l=r=!1;o[1]++<u-1&&s(n(a));)d[h=a]=i.r,d[h+1]=i.g,d[h+2]=i.b,d[h+3]=i.a,0<o[0]&&(s(n(a-4))?r||(g.push([o[0]-1,o[1]]),r=!0):r=r&&!1),o[0]<c-1&&(s(n(a+4))?l||(g.push([o[0]+1,o[1]]),l=!0):l=l&&!1),a+=4*c}this.putImageData(p,0,0)});